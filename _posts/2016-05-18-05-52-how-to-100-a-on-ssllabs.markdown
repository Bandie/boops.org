---
layout: post
title:  "How To 100%/A+ On SSLLabs"
date:   2016-05-18 05:52:00 -0600
---
![Header Image](https://cdn.frgl.pw/blog/3/1.png)

**A Few Notes** before preceding this is written with only NGINX in mind and using NGINX 1.4.X if you are using a diffrent web server software you won't be able to copy pasta but the ciphers + curves used will be the same for any software.

**Another important note on** this is that you you will loose some compatibility with devices. What devices you ask? well the big one is slightly older phones
![android ssl](https://cdn.frgl.pw/blog/3/2.png)
This surpirsed me when i first saw it as i thought my poor old S3 would atleast support TLS1.2 but sadly it does not but hay could be worse. the fix to support older phones/devices is quite simple luckily all you have todo is add "TLSv1.1 TLSv1" to your ssl_protococals so it should end up looking like this
`ssl_protocols TLSv1.2 TLSv1.1 TLSv1;`

The first thing you're going to need is a vaild SSL Cert. The Cheapest/Fastest way i know to do this is to use [LetsEncrypt](https://letsencrypt.org/getting-started/) once you've installed letsencrypt aka running "./letsencrypt-auto" in the cloned directory you need to get them to issue you a cert so while in the cloned directory and run 
`./letsencrypt-auto certonly --standalone -d <domain name> --rsa-key-size 4096`   
if you would like one for www.<domain name> then for the -d flag you can put 
`-d www.<domain name>,<domain name>`

Now we have a certificate for our domain...now what? Now we simply add it to nginx and since we used letsencrypt to do this we only have to edit two lines in our nginx config
`ssl_certificate /etc/letsencrypt/live/<your domain>/fullchain.pem;`        
`ssl_certificate_key /etc/letsencrypt/live/<your domain>/privkey.pem;`   
As i'm sure you noticed these point into letsencrypts' full path. I do this to allow for easy updating of ssl certificates as you can just re-run the letsencrypt command and bam updated certificates!

And now for the meat of this post the ssl engine config flags so for those of you that only want the flags and don't care or already have an idea what they mean
`ssl_session_timeout 5m;`                                 
`ssl_session_cache shared:TLS:2m;`                          
`add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains';`           
`ssl_ecdh_curve secp384r1;`             
`ssl_protocols TLSv1.2;`              
`ssl_ciphers ECDH+AES256:!aNULL:!eNULL:!LOW:!RC4:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS:!DH;`              
`ssl_prefer_server_ciphers on;`  

So what do these all do? let's go one at a time here.

`ssl_session_timeout 5m;`               
This forces the client to renogiate with the server after X time in this case the time has been set to 5m As you could set this higher i don't recommend it as this won't cause to much more of a load on your webserver and it really helps the client be secure!

`ssl_session_cache shared:TLS:2m;`                
 This argument allows nginx to share the TLS cache between all worker processes and will remove session from all processes once it times out

 `add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains';`       
This argument forces HTTPS for your webserver this argument is important for people that are on vulnerable networks.

 `ssl_ecdh_curve secp384r1;`                                       
This argument tells the nginx server to use the secp384r1 curve over the default secp256r1 helping keep your server more secure.

`ssl_protocols TLSv1.2;`                     
As you might be able to guess this argument tells nginx what protocols are allowed/used on the webserver a note here NEVER Use anything less the TLSv1!

`ssl_ciphers ECDH+AES256:!aNULL:!eNULL:!LOW:!RC4:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS:!DH;`         
And now finally the cipher list this is one of the most if not the most important part of your SSL config telling your nginx what ciphers to use. This is often the first place to check and edit if users are saying that they are unable to connect.

If you have any questions, comments or anything else please [Email Me](mailto:admin@boops.me)!
